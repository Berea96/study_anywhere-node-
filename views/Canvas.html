<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="/farbtastic.css" />
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/farbtastic.js"></script>
    
    <style type="text/css">
body {
	margin: 20px;
}

canvas {
	cursor: crosshair;
	-webkit-box-shadow: 1px 1px 20px #ccc;
	-moz-box-shadow: 1px 1px 20px #ccc;
	box-shadow: 1px 1px 20px #ccc;
}
</style>

<!-- <script type="text/javascript">
    	// 뒤로가기 버튼 방지 
 
		var killBackSpace = function(e) {
		e = e ? e : window.event;
		var t = e.target ? e.target : e.srcElement ? e.srcElement : null;
		if (t
				&& t.tagName
				&& (t.type && /(password)|(text)|(file)/.test(t.type
						.toLowerCase()))
				|| t.tagName.toLowerCase() == 'textarea') {
			return true;
		}
		var k = e.keyCode ? e.keyCode : e.which ? e.which : null;
		if (k == 8) {
			if (e.preventDefault) {
				e.preventDefault();
			}
			return false;
		}
		return true;
	};
	if (typeof document.addEventListener != 'undefined') {
		document.addEventListener('keydown', killBackSpace, false);
	} else if (typeof document.attachEvent != 'undefined') {
		document.attachEvent('onkeydown', killBackSpace);
	} else {
		if (document.onkeydown != null) {
			var oldOnkeydown = document.onkeydown;
			document.onkeydown = function(e) {
				oldOnkeydown(e);
				killBackSpace(e);
			};
		} else {
			document.onkeydown = killBackSpace;
		}
	}
</script>

<script type="text/javascript">
	history.pushState(null, document.title, location.href);
	window.addEventListener('popstate', function(event) {
		history.pushState(null, document.title, location.href);
	});
</script> -->


<script>
      // Point 생성자 함수를 생성합니다.
      function Point(event, target) {
          this.x = event.pageX - $(target).position().left;
          this.y = event.pageY - $(target).position().top;
      }
  </script>
    <script>
    
        $(document).ready(function () {
        	
        	if('<%= room %>' == ''){
        		alert('로그인을 다시해주세요!');
        		location.href='http://localhost/Study_Anywhere';
        	}
        	
        	console.log('<%= room %>');
            // Canvas 객체를 추출합니다.
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            // 소켓 이벤트를 연결합니다.
            var socket = io.connect();

            // 변수를 선언합니다.
            var width = 5;
            var color = '#000000';
            var isDown = false;
            var newPoint, oldPoint;

            // UI를 구성합니다.
            $('#colorpicker').farbtastic(function (data) {
                color = data;
            });

            

            
            // 이벤트를 연결합니다.
            canvas.addEventListener('mousedown', function (event) {
                isDown = true;
                oldPoint = new Point(event, this);
            });
            canvas.addEventListener('mouseup', function () { isDown = false; });
            canvas.addEventListener('mousemove', function (event) {
                if (isDown) {
                    newPoint = new Point(event, this);
                    socket.emit('draw', {
                        width: width,
                        color: color,
                        x1: oldPoint.x,
                        y1: oldPoint.y,
                        x2: newPoint.x,
                        y2: newPoint.y
                    });
                    oldPoint = newPoint;
                }
            });

            $('#sliderA').change(function () {
                width = $(this).val();
            });



            socket.on('line', function (data) {
                context.lineWidth = data.width;
                context.strokeStyle = data.color;
                context.beginPath();
                context.moveTo(data.x1, data.y1);
                context.lineTo(data.x2, data.y2);
                context.stroke();
            });
        });
        

        
    </script>
    <style media="screen">
      input {
        width: 95%;
      }
    </style>
    <script>
    </script>
</head>
<body>
    <table border="10">
        <tr>
            <td rowspan="3">
                <!-- 캔버스 -->
                <canvas id="canvas" width="1200" height="800"></canvas>
            </td>
            <td height="200">
                <!-- 색상 선택기 -->
                <div id="colorpicker"></div>
            </td>
        </tr>
        <tr>
        	<td>
        	<button id="pen" onclick="pen();">펜</button>
        	<button id="eraser" onclick="eraser()">지우개</button>
        	</td>
        </tr>
        <tr>
            <td height="25">
                <!-- 슬라이더: 두께 선택 -->
                <div align="center">두께조절</div>
                <input id="sliderA" type="range" min="0" max="20" value="5" /><br/>
            </td>
        </tr>
        <tr>
            <td style="background: lightgray"></td>
        </tr>
    </table>
</body>
</html>
